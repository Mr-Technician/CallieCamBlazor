<PageTitle>Index</PageTitle>
@page "/"
@using System.Text.Json;
@using System.Device.Gpio;

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-16">
	<iframe src="http://192.168.0.105:8080/min.php" title="CallieCam" scrolling="no" style="width:1024px;height:576px;border:none;margin-top:-50px;margin:auto;display:block;"></iframe>

	<MudButton OnClick="(() => GetSensorData())">Refresh Data</MudButton>
	<MudButton OnClick="(() => ToggleLights(true))">LEDs On</MudButton>
	<MudButton OnClick="(() => ToggleLights(false))">LEDs Off</MudButton>

	<MudText>@temp</MudText>
	<MudText>@humidity</MudText>
</MudContainer>

@code {
	double temp;
	double humidity;

	private async Task GetSensorData()
	{
		var result = await Task.Run(() => "./sensor".Bash());
		Console.WriteLine(result);
		var tuple = JsonSerializer.Deserialize<Tuple<double, double>>(result);
		Console.WriteLine(tuple?.Item1);
		temp = tuple?.Item1 ?? 0;
		humidity = tuple?.Item2 ?? 0;
	}

	private void ToggleLights(bool state)
	{
		int led1 = 2;
		int led2 = 3;
		int led3 = 4;
		int led4 = 17;
		using var controller = new GpioController();
		controller.OpenPin(led1, PinMode.Output);
		controller.OpenPin(led2, PinMode.Output);
		controller.OpenPin(led3, PinMode.Output);
		controller.OpenPin(led4, PinMode.Output);

		controller.Write(led1, ((state) ? PinValue.High : PinValue.Low));
		controller.Write(led2, ((state) ? PinValue.High : PinValue.Low));
		controller.Write(led3, ((state) ? PinValue.High : PinValue.Low));
		controller.Write(led4, ((state) ? PinValue.High : PinValue.Low));
	}
}